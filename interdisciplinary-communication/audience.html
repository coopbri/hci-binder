<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">

    <title>D3 Audience Sort</title>

    <!-- load D3 -->
    <script src="https://rawcdn.githack.com/coopbri/hci-binder/362464110b5273593e9fdd1dc1c0ae3e4f1da224/lib/d3.min.js"></script>

    <!-- global styles -->
    <style>
      body { font-family: Helvetica; }
      svg  { -moz-user-select: none;
             -webkit-user-select: none;
             -ms-user-select: none;
             user-select: none;
           }
    </style>
  </head>

  <body>
    <script>
      var body = d3.select("body");
      var svg = body.append("svg")
        .attr("width", 700)
        .attr("height", 500);

      // possible statements to be sorted
      var statements = ["We built this decision-tree method based on the stochastic nature of the underlying fundamentals of known spatio-temporal interactions between objects of this type and character.",
                        "Lets define that term: heterogeneous. It means when something is made up of diverse components, or things that are dissimilar in nature.",
                        "I'm in the field of Geographic Information Science, or GIS - I work with spatial data for analysis and presentation.",
                        "The resulting features, thiessen polygons, represent areas nearest the points based on proximity: the same idea behind the voronoi diagram in math.",
                        "As we know from Anselin's work in spatial statistics, the I statistic allows us to identify spatial clusters of features with high or low values.",
                        "Now, when I say 'high performance computing', what does that mean to you?"];

      // final message (hidden until complete)
      var finish = svg.append("text")
        .text("")
        .attr("x", 80)
        .attr("y", 100)
        .attr("font-size", 20)
        .attr("fill-opacity", 0)
        .style("fill", "#32C90F");

      // response message
      var msg = body.append("p").text("This is a work in progress! There are still a handful of bugs.")
        .style("color", "red");

      var drag = d3.drag()
        .on("start", function () {
          var cur = d3.select(this);
          dx = cur.attr("x") - d3.event.x;
          dy = cur.attr("y") - d3.event.y;
        })
        .on("drag", function() {
          d3.select(this)
            .attr("x", d3.event.x + dx)
            .attr("y", d3.event.y + dy);
        })
        // check solution for current word
        .on("end", function() {
          d3.select(this)
            .attr("x", d3.event.x + dx)
            .attr("y", d3.event.y + dy);

          var x = d3.select(this).attr("x");
          var y = d3.select(this).attr("y");
          var text = d3.select(this).select("text")._groups[0][0].innerHTML;

          // check solution: experts in the field
          if (x >= 000 && x <= 000 && y <= 000 && y >= 000) {
            checkEF(text);
          }
          // check solution: introductory class
          if (x >= 000 && x <= 000 && y <= 000 && y >= 000) {
            checkIC(text);
          }
          // check solution: casual conversation
          if (x >= 000 && x <= 000 && y <= 000 && y >= 000) {
            checkCC(text);
          }
          // check solution: experts in a different field
          if (x >= 000 && x <= 000 && y <= 000 && y >= 000) {
            checkEDF(text);
          }
        });

        // draw statement from "deck" for placement
        function drawCard() {
          d3.selectAll(".drawn")
            .transition().duration(800)
              .attr("fill-opacity", 0)
              .attr("stroke-opacity", 0)
            .remove();

          // draw random term from selection
          var s = statements[Math.floor(Math.random() * statements.length)];

          // nested SVG for drag translation
          var card = svg.append("svg").classed("card", true);

          // while terms are still left in array, draw card
          if (statements && statements.length) {
            // card frame
            card.append("rect")
              .classed("drawn", true)
              .attr("width", 320)
              .attr("height", 50)
              .attr("x", 180)
              .attr("y", 70)
              .attr("fill", "white")
              .attr("stroke", "black")
              .attr("fill-opacity", 1)
              .attr("stroke-opacity", 1)
              .attr("stroke-width", "4px");

            // card text
            card.append("text")
              .classed("drawn", true)
              .text(s)
              .attr("text-anchor", "middle")
              .attr("fill-opacity", 1)
              .attr("stroke-opacity", 1)
              .attr("x", 340)
              .attr("y", 100);
          } else {
            finish.transition().duration(800)
              .text("Your choice of words matters in this communication. Context is incredibly important for understanding the best way to communicate, and there are impacts of those choices in communicating with different audiences.")
              .attr("fill-opacity", 1);
          }

          // remove selected element from array
          statements = statements.filter(function(item) { return item !== s; });

          // enable dragging of the card
          drag(d3.selectAll(".card"));
        }

        drawCard();
    </script>
  </body>
</html>
